!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@donkeyclip/motorcortex")):"function"==typeof define&&define.amd?define(["@donkeyclip/motorcortex"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["my-plugin-name"]=t(e.MotorCortex)}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function a(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=o(e);if(t){var r=o(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return a(this,n)}}var l=function(e){r(o,e);var n=u(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"html",get:function(){return this.width=this.attrs.width||640,this.height=this.attrs.height||360,this.startFrom=this.attrs.startFrom||0,"\n      <div></div>\n    "}},{key:"css",get:function(){return"\n      #video{\n        display:none;\n      }\n    "}},{key:"subscribeVideoListener",value:function(e){this.subscribers||(this.subscribers=[]),this.subscribers.push(e)}},{key:"setVolume",value:function(e){this.entity.player.setVolume(100*e*(this.attrs.volume||1))}},{key:"onAfterRender",value:function(){var e=this;this.contextLoading();var t,n=this,i={player:t,startFrom:this.startFrom,loaded:!1,subscribeVideoListener:function(e){return n.subscribeVideoListener(e)}};this.entity=i,this.setCustomEntity("video",i);var r=this.context.document.createElement("script");r.src="https://www.youtube.com/iframe_api",this.context.rootElement.appendChild(r),window.onYouTubeIframeAPIReady=function(){t=new YT.Player(e.context.getElements("div")[0],{height:e.attrs.height,width:e.attrs.width,videoId:e.attrs.videoId,playerVars:{controls:0,playsinline:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0,ecver:2,start:e.startFrom/1e3},events:{onReady:function(){i.loaded=!0,i.player=t;var e=n.DescriptiveIncident.volumeChangeSubscribe(n.id,n.setVolume.bind(n));n.setVolume(e),n.contextLoaded()},onStateChange:function(e){if(n.subscribers)for(var t=0;t<n.subscribers.length;t++)n.subscribers[t](e.data)}}})}}}]),o}(e.BrowserClip),c=function(e){r(o,e);var n=u(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"onInitialise",value:function(){this.element.entity.subscribeVideoListener(this.stateChange.bind(this))}},{key:"play",value:function(e){var t=this.element.entity,n=t.player.getPlayerState();return-1===n||3===n?(t.player.seekTo((e+this.element.entity.startFrom)/1e3),t.player.playVideo(),this.waitingHandler()):(1!==n&&(t.player.seekTo((e+this.element.entity.startFrom)/1e3),t.player.playVideo()),!0)}},{key:"stateChange",value:function(e){switch(e){case 3:this.waitingHandler();break;case 1:this.canplayHandler()}}},{key:"waitingHandler",value:function(){this.setBlock("Video loading",{exceptional:!0})}},{key:"canplayHandler",value:function(){this.unblock()}},{key:"stop",value:function(){this.element.entity.player.pauseVideo()}},{key:"onProgress",value:function(e,t){var n=t+this.element.entity.startFrom;-1!==this.element.entity.player.getPlayerState()&&5!==this.element.entity.player.getPlayerState()||this.element.entity.player.pauseVideo(),this.element.entity.player.seekTo(n/1e3)}}]),o}(e.MediaPlayback);return{npm_name:"my-plugin-name",version:"0.0.1",incidents:[{exportable:c,name:"Playback"}],Clip:{exportable:l,attributesValidationRules:{width:{optional:!0,type:"number",integer:!0,positive:!0},height:{optional:!0,type:"number",integer:!0,positive:!0},startFrom:{optional:!0,type:"number",integer:!0,min:0},videoId:{type:"string"},volume:{type:"number",min:0,max:1,default:1}}},capabilities:{speed:!1,preview:!1},audio:"on"}}));
